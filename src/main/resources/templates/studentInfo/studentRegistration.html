<!DOCTYPE html>
<html lang="kr" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/basic}" dir="ltr">

<th:block layout:fragment="title">
    <title>YU Main</title>
</th:block>
<th:block layout:fragment="middle">
    <div class="modal fade" id="subjectModal" tabindex="-1" role="dialog"
         aria-labelledby="subjectModalLabel" aria-hidden="true" data-keyboard="false" data-backdrop="static">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="subjectModalLabel"></h5>
                </div>
                <div class="modal-body">
                    <h5>전공 영역</h5>
                    <form>
                        <div class="filter">
                            <ul class="category">
                                <li class="dropdown">
                                    <a class="dropdown-toggle" id="dropdown" data-toggle="dropdown">
                                        문과대학
                                    </a>
                                    <ul class="dropdown-menu" aria-labelledby="dropdown">
                                        <li class="child">국어국문학과</li>
                                        <li class="child">중국언어문화학과</li>
                                        <li class="child">일어일문학과</li>
                                        <li class="child">영어영문학과</li>
                                        <li class="parent folded">유럽언어문화학부</li>
                                        <ul class="folded">
                                            <li class="child">유럽언어문화학부</li>
                                            <li class="child">프랑스어문전공</li>
                                            <li class="child">독일언어문화전공</li>
                                        </ul>
                                        <li class="child">철학과</li>
                                        <li class="child">역사학과</li>
                                        <li class="child">문화인류학과</li>
                                        <li class="child">심리학과</li>
                                        <li class="child">사회학과</li>
                                        <li class="child">언론정보학과</li>
                                        <li class="child">국어국문학과(야)</li>
                                    </ul>
                                </li>
                                <li class="parent folded">자연과학대학</li>
                                <ul class="folded"><li class="child">수학과</li><li class="child">통계학과</li><li class="child">물리학과</li><li class="parent folded">화학생화학부</li><ul class="folded"><li class="child">화학생화학부</li><li class="child">화학전공</li><li class="child">생화학전공</li></ul><li class="child">생명과학과</li></ul><li class="parent folded">공과대학</li><ul class="folded"><li class="child">건설시스템공학과</li><li class="child">환경공학과</li><li class="child">도시공학과</li><li class="parent folded">신소재공학부</li><ul class="folded"><li class="child">신소재공학전공</li></ul><li class="parent folded">화학공학부</li><ul class="folded"><li class="child">화학공학부</li><li class="child">고분자·바이오소재전공</li><li class="child">화공시스템전공</li><li class="child">융합화학공학전공</li><li class="child">에너지화공전공</li></ul><li class="child">파이버시스템공학과</li></ul><li class="parent folded">기계IT대학</li><ul class="folded"><li class="child">기계IT대학</li><li class="parent folded">기계공학부</li><ul class="folded"><li class="child">기계공학부</li><li class="child">기계시스템전공</li><li class="child">기계설계전공</li><li class="child">첨단기계전공</li></ul><li class="child">전기공학과</li><li class="child">전자공학과</li><li class="child">컴퓨터공학과</li><li class="child">정보통신공학과</li><li class="child">자동차기계공학과</li><li class="child">로봇기계공학과</li><li class="child">전기공학과(야)</li></ul><li class="parent folded">정치행정대학</li><ul class="folded"><li class="child">정치외교학과</li><li class="child">행정학과</li><li class="child">새마을국제개발학과</li><li class="child">경찰행정학과</li><li class="child">군사학과</li><li class="child">정치외교학과(야)</li><li class="child">행정학과(야)</li><li class="child">새마을국제개발학과(야)</li></ul><li class="parent folded">상경대학</li><ul class="folded"><li class="child">상경대학</li><li class="parent folded">경제금융학부</li><ul class="folded"><li class="child">경제금융전공</li></ul><li class="parent folded">무역학부</li><ul class="folded"><li class="child">무역학전공</li></ul><li class="parent folded">경제금융학부(야)</li><ul class="folded"><li class="child">경제금융전공(야)</li></ul><li class="parent folded">무역학부(야)</li><ul class="folded"><li class="child">무역학전공(야)</li></ul></ul><li class="parent folded">경영대학</li><ul class="folded"><li class="child">경영대학</li><li class="child">경영학과</li><li class="child">회계세무학과</li><li class="child">경영학과(야)</li></ul><li class="parent folded">의과대학</li><ul class="folded"><li class="child">의예과</li></ul><li class="parent folded">약학대학</li><ul class="folded"><li class="parent folded">약학부</li><ul class="folded"><li class="child">약학전공</li><li class="child">제약학전공</li></ul></ul><li class="parent folded">생명응용과학대학</li><ul class="folded"><li class="child">식품경제외식학과</li><li class="child">원예생명과학과</li><li class="child">산림자원및조경학과</li><li class="child">식품공학과</li><li class="child">생명공학과</li><li class="child">의생명공학과</li><li class="child">외식산업학과</li></ul><li class="parent folded">생활과학대학</li><ul class="folded"><li class="child">가족주거학과</li><li class="child">식품영양학과</li><li class="parent folded">체육학부</li><ul class="folded"><li class="child">체육학부</li><li class="child">체육학전공</li><li class="child">무용학전공</li></ul><li class="child">의류패션학과</li></ul><li class="parent folded">사범대학</li><ul class="folded"><li class="child">교육학과</li><li class="child">국어교육과</li><li class="child">영어교육과</li><li class="child">한문교육과</li><li class="child">수학교육과</li><li class="child">유아교육과</li><li class="child">특수체육교육과</li></ul><li class="parent folded">디자인미술대학</li><ul class="folded"><li class="parent folded">미술학부</li><ul class="folded"><li class="child">미술학부</li><li class="child">회화전공</li><li class="child">트랜스아트전공</li></ul><li class="child">시각디자인학과</li><li class="child">산업디자인학과</li><li class="child">생활제품디자인학과</li></ul><li class="parent folded">음악대학</li><ul class="folded"><li class="child">음악과</li><li class="child">성악과</li><li class="child">기악과</li></ul><li class="parent folded">건축학부</li><ul class="folded"><li class="parent folded">건축학부</li><ul class="folded"><li class="child">건축학부</li><li class="child">건축학전공</li><li class="child">건축디자인전공</li><li class="child">건축공학전공</li></ul></ul><li class="parent folded">기초교육대학</li><ul class="folded"><li class="parent folded">천마인재학부</li><ul class="folded"><li class="child">정책과학전공</li></ul><li class="child">인문자율전공학부</li></ul><li class="parent folded">국제학부</li><ul class="folded"><li class="child">국제학부</li></ul><li class="parent folded">연계전공</li><ul class="folded"><li class="parent folded">연계</li><ul class="folded"><li class="child">국제학전공</li><li class="child">유럽학전공</li><li class="child">그린카전공</li><li class="child">다문화전공</li><li class="child">문화유산해설전공</li><li class="child">통합사회교육전공</li><li class="child">통합과학교육전공</li><li class="child">부동산학전공</li><li class="child">기술가정교육전공</li><li class="child">사회복지전공</li><li class="child">도덕윤리교육전공</li><li class="child">그린에너지전공</li><li class="child">글로벌차이나전공</li><li class="child">국제개발및새마을학전공</li><li class="child">에너지하이브리드융복합전공</li><li class="child">금융보험전공</li><li class="child">기술혁신·기업가정신전공</li><li class="child">미술보존복원전공</li><li class="child">기계IT융합전공</li><li class="child">스마트워터시스템융합전공</li></ul></ul></ul></div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal">확인</button>
                </div>
            </div>
        </div>
    </div>
</th:block>
<th:block layout:fragment="article">
    <div th:if="${session.studentInfo} == null">
        <div class="container-fluid">
            <div class="card bg-light mt-3">
                <div class="card-header bg-light">
                    <h2>최초 로그인</h2>
                    <br>
                    <div class="row">
                        <div class="col-8 text-left">최초 로그인시 입력이 필요합니다! </div>
                        <div class="col-8 text-left">입력하신 정보는 "내 정보"에서 수정가능합니다.</div>
                    </div>
                </div>
                <form id="infoForm" name="infoForm" onSubmit='return dataSend()' method="post">
                    <input type="hidden" id="sid" name="sid" class="form-control" th:value="${userSid}" required="required" readonly/>
                    <div class="card-header bg-light">
                        <div class="row">
                            <div class="form-group">
                                <label for="department" class="col-form-label"><h5>학과</h5></label>
                                <input type="text" id="department" name="department" class="form-control" placeholder="학과 선택" required="required" readonly/>
                                <button type="button" class="btn btn-primary" onclick="departmentOpen()">학과</button>
                            </div>
                        </div>
                    </div>
                    <div class="card-header bg-light">
                        <div class="row">
                            <div class="form-group">
                                <label for="nickName" class="col-form-label"><h5>닉네임</h5></label>
                                <input type="text" id="nickname" name="nickname" class="form-control" placeholder="닉네임 입력" required="required"/>
                            </div>
                        </div>
                    </div>
                    <div class="card-header bg-light">
                        <div class="row">
                            <div class="form-group">
                                <label for="yourEmail" class="col-form-label"><h5>이메일</h5></label>
                                <input type="text" id="email" name="email" class="form-control" placeholder="이메일 입력" required="required"/>
                            </div>
                        </div>
                    </div>

                    <div class="card-header bg-light">
                        <div class="row">
                            <div class="form-group">
                                <label for="phoneNumber" class="col-form-label"><h5>휴대폰 번호</h5></label>
                                <input type="text" id="phonenum" name="phonenum" class="form-control" placeholder="번호 입력" required="required"/>
                                <button type="button" id="sendPhoneNumber" class="btn btn-primary">인증받기</button>
                            </div>
                        </div>
                    </div>

                    <div class="card-header bg-light">
                        <div class="row">
                            <div class="form-group">
                                <label for="certificationNumber" class="col-form-label"><h5>인증 번호</h5></label>
                                <input type="text" id="CertifiedNumber" class="form-control" placeholder="인증번호 입력" required="required"/>
                                <button type="button" id="checkBtn" class="btn btn-primary">체크</button>
                            </div>
                        </div>
                    </div>
                    <div class="card-header bg-light">
                        <div class="row">
                            <div class="form-group">
                                <div class="input-group mb-3">
                                    <div class="input-group-append">
                                        <label class="input-group-text" for="gender">성별</label>
                                    </div>
                                    <select class="custom-select" id="gen" name="gen">
                                        <option value="select" selected>성별을 선택해주세요</option>
                                        <option value="M">남자</option>
                                        <option value="F">여자</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-header bg-light">
                        <div class="row">
                            <div class="form-group">
                                <div class="input-group mb-3">
                                    <div class="input-group-append bg-light">
                                        <label class="input-group-text" for="grade">학년</label>
                                    </div>
                                    <select class="custom-select" id="syear" name="syear">
                                        <option value="select" selected>학년을 선택해주세요</option>
                                        <option value="1">1학년</option>
                                        <option value="2">2학년</option>
                                        <option value="3">3학년</option>
                                        <option value="4">4학년</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div id="button_group" class="btn-form">
                            <button type="submit" class="btn btn-primary float-right" style="margin-right:5px;">등록</button>
                            <button class="btn btn-primary float-right" style="margin-right:5px;" onclick="location.href='/yu/logout'">취소</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</th:block>

<th:block layout:fragment="script">
    <script type="text/javascript">
        function departmentOpen(){
            $('#subjectModal').modal('show');
        }
        function dataSend() {
            //var gender = $(":input:radio[name=gen]:checked").val();
            var queryString = $("form[name=infoForm]").serialize();
            //JSON.stringify($("form[name=infoForm]").serializeObject());
            /*var messageDTO={
                result:data
           };*/
            //alert(queryString);
            var gen = $("#gen");
            var syear = $("#syear");

            if($("#nickname").val().length < 2 || $("#nickname").val().length > 12) {
                alert("닉네임은 2자 이상 12자 이하 입니다");
                $("#nickname").focus();
                return false;
            }
            else if(gen.val() == "select") {
                alert("성별을 선택해 주세요");
                gen.focus();
                return false;
            }
            else if(syear.val() == "select") {
                alert("학년을 선택해 주세요");
                syear.focus();
                return false;
            }

            if(!$('#CertifiedNumber').prop("readonly")){
                alert("휴대폰 인증을해주세요");
                return false;
            }
            $.ajax({
                type: "POST",
                url : "/yu/studentInfo/studentRegistrationData",
                /*data : { sid : $("#sid").val(),
                         department : $("#department").val(),
                         syear : $("#syear").val(),
                         nickname : $("#nickname").val(),
                         email : $("#email").val(),
                         gen : gender
                },*/
                data : queryString,
                //contentType:'application/json; charset=utf-8',
                //contentType:'application/x-www-form-urlencoded; charset=utf-8',
                //datatype : 'json',
                success : function(data){
                    if(data == true) {
                        alert("등록 성공, 재로그인 해주세요.");
                        location.href='/yu/logout';
                    }
                    else
                        alert("등록 실패");
                },error : function(){
                    alert("Error");
                    return false;
                }
            });
            return false;
        }

        $('#sendPhoneNumber').click(function(){
            let phoneNumber = $('#phonenum').val();
            var regPhone = /^((01[1|6|7|8|9])[1-9]+[0-9]{6,7})|(010[1-9][0-9]{7})$/;
            if(!regPhone.test(phoneNumber)){
                alert("휴대폰번호를 입력해주세요");
                return false;
            }
            alert("인증번호 요청완료");

            $.ajax({
                type: "GET",
                url: "/check/sendSMS",
                data: {
                    phoneNumber : phoneNumber
                },
                contentType: "application/x-www-form-urlencoded; charset=UTF-8",
                success: function(res){
                    $('#checkBtn').click(function(){
                        if(res ==$('#CertifiedNumber').val()){
                            alert("인증성공");
                            $('#CertifiedNumber').attr("readonly",true);
                            $('#phonenum').attr("readonly",true);
                        }else{
                            alert("인증실패");
                        }
                    })
                }
            })
        });
    </script>
</th:block>
</html>